This is the final project of the academic course "18737 Engineering Safe Software Systems" 2019 Fall in 
Carnegie Mellon University Sillicon Valley. We apply the testing tools KLEE & AFL to wpa_cli, a open-source 
command-line interface communicates with Wi-Fi management tool wpa_supplicant. 
Please refer to http://w1.fi/cgit/hostap/ for more details about the wpa_cli/wpa_supplicant.


# 1) Environment Setup
These steps are tested under 18.04.1-Ubuntu.

## KLEE

Please refer to KLEE website https://klee.github.io for more detail.

1. **Install dependencies** 

<pre>
  sudo apt-get install \
    build-essential curl libcap-dev git cmake libncurses5-dev \
    python-minimal python-pip unzip libtcmalloc-minimal4 \
    libgoogle-perftools-dev libsqlite3-dev doxygen
  sudo apt-get install clang-6.0 llvm-6.0 llvm-6.0-dev llvm-6.0-tools
  sudo apt-get install cmake bison flex libboost-all-dev python perl minisat
  pip3 install tabulate
  
</pre>

2. **Build STP as the constraint solver**

<pre>
  git clone https://github.com/stp/stp
  cd stp
  mkdir build
  cd build
  cmake ..
  make -j8
  sudo make install
</pre>

3. **Build uClibc and the POSIX environment model for KLEE**

<pre>
  git clone https://github.com/klee/klee-uclibc.git
  cd klee-uclibc
  ./configure --make-llvm-lib
  make -j8
</pre>

4. **Build KLEE source code**

<pre>
  git clone https://github.com/klee/klee.git
  cd klee
  mkdir build
  cd build
  cmake \
      -DENABLE_SOLVER_STP=ON \
      -DENABLE_POSIX_RUNTIME=ON \
      -DENABLE_KLEE_UCLIBC=ON \
      -DKLEE_UCLIBC_PATH=~/klee-uclibc \
      -DENABLE_UNIT_TESTS=OFF \
      -DENABLE_SYSTEM_TESTS=OFF \
      -DLLVM_CONFIG_BINARY=/usr/bin/llvm-config-6.0 \
      -DLLVMCC=/usr/bin/clang-6.0 \
      -DLLVMCXX=/usr/bin/clang++-6.0  \
      /home/shaomin/Desktop/klee
   make -j8
   cp ./bin/* /usr/bin
   cp -r ./../include/klee /usr/include
</pre>

## AFL
Please refer to https://github.com/google/AFL, https://github.com/mrash/afl-cov for more detail.
1. **Install afl and afl-cov**

<pre>
  sudo apt-get install afl afl-cov
</pre>

# Run testing

All added testing codes and scripts locate at *"wpa_supplicant/testings"* folder. 

## KLEE
1. **Build wpa_cli and wrapper**

<pre>
  cd "wpa_supplicant/testings/klee/"
  ./build
</pre>

2. **Run KLEE**

<pre>
  ./build run 
</pre>

3. **Replay input generated by KLEE and show testing coverage**

<pre>
  ./build cov
</pre>

4. **Find the argument list (testcase) with the largest test coverage**

<pre>
  ./build cov-find <klee-output:default is klee-last> 
</pre>

5. **Remove unnecessary file manually**

<pre>
  ./build clean 
</pre>

## AFL
1. **Build wpa_cli and wrapper**

<pre>
  cd "wpa_supplicant/testings/afl"
  ./build
</pre>

2. **Run AFL/AFL-COV without chnage system settings**

<pre>
  ./build run ignore
</pre>

3. **Run AFL/AFL-COV with knowledge of arguments without chnage system settings**

<pre>
  ./build run-dict ignore
</pre>

4. **Show testing coverage**

<pre>
  ./build cov
</pre>

5. **Remove unnecessary file manually**

<pre>
  ./build clean 
</pre>
